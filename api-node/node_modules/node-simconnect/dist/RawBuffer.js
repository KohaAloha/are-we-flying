"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.RawBuffer = void 0;
const ByteBuffer = require("bytebuffer");
class RawBuffer {
    constructor(b) {
        /** @deprecated use readInt32() instead */
        this.readInt = this.readInt32;
        /** @deprecated use writeInt32() instead */
        this.writeInt = this.writeInt32;
        /** @deprecated use readInt64() instead */
        this.readLong = this.readInt64;
        /** @deprecated use writeInt64() instead */
        this.writeLong = this.writeInt64;
        /** @deprecated use readFloat32() instead */
        this.readFloat = this.readFloat32;
        /** @deprecated use writeFloat32() instead */
        this.writeFloat = this.writeFloat32;
        /** @deprecated use readFloat64() instead */
        this.readDouble = this.readFloat64;
        /** @deprecated use writeFloat64() instead */
        this.writeDouble = this.writeFloat64;
        if (typeof b === 'number') {
            this.buffer = ByteBuffer.allocate(b).LE(true);
        }
        else {
            this.buffer = ByteBuffer.wrap(b).LE(true);
        }
    }
    clear() {
        this.buffer.clear();
    }
    setOffset(offset) {
        this.buffer.offset = offset;
    }
    flip() {
        this.buffer.flip();
    }
    getOffset() {
        return this.buffer.offset;
    }
    getBuffer() {
        this.buffer.flip();
        return this.buffer.toBuffer(true);
    }
    write(bytes) {
        this.buffer.append(bytes);
    }
    writeByte(byte) {
        this.buffer.writeByte(byte);
    }
    readBytes(length) {
        const bytes = this.buffer.readBytes(length).copy();
        return bytes.toBuffer();
    }
    readInt32() {
        return this.buffer.readInt32();
    }
    writeInt32(value, offset) {
        this.buffer.writeInt32(value, offset);
    }
    readInt64() {
        return this.buffer.readInt64().toNumber();
    }
    writeInt64(value) {
        this.buffer.writeInt64(value);
    }
    readFloat32() {
        return this.buffer.readFloat32();
    }
    writeFloat32(value) {
        this.buffer.writeFloat32(value);
    }
    readFloat64() {
        return this.buffer.readFloat64();
    }
    writeFloat64(value) {
        this.buffer.writeFloat64(value);
    }
    writeString(value, fixedLength) {
        putString(this.buffer, value, fixedLength || value.length);
    }
    readString8() {
        return makeString(this.buffer, 8);
    }
    writeString8(value) {
        putString(this.buffer, value, 8);
    }
    writeString30(value) {
        putString(this.buffer, value, 30);
    }
    readString32() {
        return makeString(this.buffer, 32);
    }
    writeString32(value) {
        putString(this.buffer, value, 32);
    }
    readString64() {
        return makeString(this.buffer, 64);
    }
    writeString64(value) {
        putString(this.buffer, value, 64);
    }
    readString128() {
        return makeString(this.buffer, 128);
    }
    writeString128(value) {
        putString(this.buffer, value, 128);
    }
    readString256() {
        return makeString(this.buffer, 256);
    }
    writeString256(value) {
        putString(this.buffer, value, 256);
    }
    readString260() {
        return makeString(this.buffer, 260);
    }
    writeString260(value) {
        putString(this.buffer, value, 260);
    }
    readStringV() {
        let bytesRead = 0;
        let strLen = 0;
        let endFound = false;
        while (this.buffer.offset < this.buffer.limit) {
            const currentByte = this.buffer.readByte();
            bytesRead++;
            if (endFound && currentByte !== 0) {
                break; // Reached beginning of new value
            }
            else if (currentByte === 0) {
                endFound = true;
            }
            strLen++;
        }
        // Reset offset so we can read the same bytes later
        this.buffer.offset -= bytesRead;
        return makeString(this.buffer, strLen);
    }
    readString(length) {
        return makeString(this.buffer, length);
    }
    remaining() {
        return this.buffer.remaining();
    }
}
exports.RawBuffer = RawBuffer;
function makeString(bf, expectedLength) {
    const content = bf.readCString(bf.offset);
    bf.skip(expectedLength);
    return content.string;
}
function putString(bf, s, fixed) {
    const value = s === null ? '' : s;
    const bytes = Buffer.from(value, 'utf-8');
    bf.append(bytes);
    if (bytes.length < fixed) {
        for (let i = 0; i < fixed - bytes.length; i++) {
            bf.writeByte(0x00);
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmF3QnVmZmVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL1Jhd0J1ZmZlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSx5Q0FBMEM7QUFFMUMsTUFBTSxTQUFTO0lBR1gsWUFBWSxDQUFrQjtRQThDOUIsMENBQTBDO1FBQzFDLFlBQU8sR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDO1FBTXpCLDJDQUEyQztRQUMzQyxhQUFRLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQztRQU0zQiwwQ0FBMEM7UUFDMUMsYUFBUSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUM7UUFNMUIsMkNBQTJDO1FBQzNDLGNBQVMsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDO1FBTTVCLDRDQUE0QztRQUM1QyxjQUFTLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQztRQU03Qiw2Q0FBNkM7UUFDN0MsZUFBVSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUM7UUFNL0IsNENBQTRDO1FBQzVDLGVBQVUsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDO1FBTTlCLDZDQUE2QztRQUM3QyxnQkFBVyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUM7UUEvRjVCLElBQUksT0FBTyxDQUFDLEtBQUssUUFBUSxFQUFFO1lBQ3ZCLElBQUksQ0FBQyxNQUFNLEdBQUcsVUFBVSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDakQ7YUFBTTtZQUNILElBQUksQ0FBQyxNQUFNLEdBQUcsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDN0M7SUFDTCxDQUFDO0lBRUQsS0FBSztRQUNELElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDeEIsQ0FBQztJQUVELFNBQVMsQ0FBQyxNQUFjO1FBQ3BCLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxHQUFH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QUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEtBQUssR0FBRyxLQUFLLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFO1lBQzNDLEVBQUUsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDdEI7S0FDSjtBQUNMLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQnl0ZUJ1ZmZlciA9IHJlcXVpcmUoJ2J5dGVidWZmZXInKTtcblxuY2xhc3MgUmF3QnVmZmVyIHtcbiAgICBwcml2YXRlIHJlYWRvbmx5IGJ1ZmZlcjogQnl0ZUJ1ZmZlcjtcblxuICAgIGNvbnN0cnVjdG9yKGI6IEJ1ZmZlciB8IG51bWJlcikge1xuICAgICAgICBpZiAodHlwZW9mIGIgPT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICB0aGlzLmJ1ZmZlciA9IEJ5dGVCdWZmZXIuYWxsb2NhdGUoYikuTEUodHJ1ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmJ1ZmZlciA9IEJ5dGVCdWZmZXIud3JhcChiKS5MRSh0cnVlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNsZWFyKCkge1xuICAgICAgICB0aGlzLmJ1ZmZlci5jbGVhcigpO1xuICAgIH1cblxuICAgIHNldE9mZnNldChvZmZzZXQ6IG51bWJlcikge1xuICAgICAgICB0aGlzLmJ1ZmZlci5vZmZzZXQgPSBvZmZzZXQ7XG4gICAgfVxuXG4gICAgZmxpcCgpIHtcbiAgICAgICAgdGhpcy5idWZmZXIuZmxpcCgpO1xuICAgIH1cblxuICAgIGdldE9mZnNldCgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5idWZmZXIub2Zmc2V0O1xuICAgIH1cblxuICAgIGdldEJ1ZmZlcigpOiBCdWZmZXIge1xuICAgICAgICB0aGlzLmJ1ZmZlci5mbGlwKCk7XG4gICAgICAgIHJldHVybiB0aGlzLmJ1ZmZlci50b0J1ZmZlcih0cnVlKTtcbiAgICB9XG5cbiAgICB3cml0ZShieXRlczogQnVmZmVyKSB7XG4gICAgICAgIHRoaXMuYnVmZmVyLmFwcGVuZChieXRlcyk7XG4gICAgfVxuXG4gICAgd3JpdGVCeXRlKGJ5dGU6IG51bWJlcikge1xuICAgICAgICB0aGlzLmJ1ZmZlci53cml0ZUJ5dGUoYnl0ZSk7XG4gICAgfVxuXG4gICAgcmVhZEJ5dGVzKGxlbmd0aDogbnVtYmVyKTogQnVmZmVyIHtcbiAgICAgICAgY29uc3QgYnl0ZXMgPSB0aGlzLmJ1ZmZlci5yZWFkQnl0ZXMobGVuZ3RoKS5jb3B5KCk7XG4gICAgICAgIHJldHVybiBieXRlcy50b0J1ZmZlcigpO1xuICAgIH1cblxuICAgIHJlYWRJbnQzMigpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5idWZmZXIucmVhZEludDMyKCk7XG4gICAgfVxuXG4gICAgLyoqIEBkZXByZWNhdGVkIHVzZSByZWFkSW50MzIoKSBpbnN0ZWFkICovXG4gICAgcmVhZEludCA9IHRoaXMucmVhZEludDMyO1xuXG4gICAgd3JpdGVJbnQzMih2YWx1ZTogbnVtYmVyLCBvZmZzZXQ/OiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5idWZmZXIud3JpdGVJbnQzMih2YWx1ZSwgb2Zmc2V0KTtcbiAgICB9XG5cbiAgICAvKiogQGRlcHJlY2F0ZWQgdXNlIHdyaXRlSW50MzIoKSBpbnN0ZWFkICovXG4gICAgd3JpdGVJbnQgPSB0aGlzLndyaXRlSW50MzI7XG5cbiAgICByZWFkSW50NjQoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYnVmZmVyLnJlYWRJbnQ2NCgpLnRvTnVtYmVyKCk7XG4gICAgfVxuXG4gICAgLyoqIEBkZXByZWNhdGVkIHVzZSByZWFkSW50NjQoKSBpbnN0ZWFkICovXG4gICAgcmVhZExvbmcgPSB0aGlzLnJlYWRJbnQ2NDtcblxuICAgIHdyaXRlSW50NjQodmFsdWU6IG51bWJlcikge1xuICAgICAgICB0aGlzLmJ1ZmZlci53cml0ZUludDY0KHZhbHVlKTtcbiAgICB9XG5cbiAgICAvKiogQGRlcHJlY2F0ZWQgdXNlIHdyaXRlSW50NjQoKSBpbnN0ZWFkICovXG4gICAgd3JpdGVMb25nID0gdGhpcy53cml0ZUludDY0O1xuXG4gICAgcmVhZEZsb2F0MzIoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYnVmZmVyLnJlYWRGbG9hdDMyKCk7XG4gICAgfVxuXG4gICAgLyoqIEBkZXByZWNhdGVkIHVzZSByZWFkRmxvYXQzMigpIGluc3RlYWQgKi9cbiAgICByZWFkRmxvYXQgPSB0aGlzLnJlYWRGbG9hdDMyO1xuXG4gICAgd3JpdGVGbG9hdDMyKHZhbHVlOiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5idWZmZXIud3JpdGVGbG9hdDMyKHZhbHVlKTtcbiAgICB9XG5cbiAgICAvKiogQGRlcHJlY2F0ZWQgdXNlIHdyaXRlRmxvYXQzMigpIGluc3RlYWQgKi9cbiAgICB3cml0ZUZsb2F0ID0gdGhpcy53cml0ZUZsb2F0MzI7XG5cbiAgICByZWFkRmxvYXQ2NCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYnVmZmVyLnJlYWRGbG9hdDY0KCk7XG4gICAgfVxuXG4gICAgLyoqIEBkZXByZWNhdGVkIHVzZSByZWFkRmxvYXQ2NCgpIGluc3RlYWQgKi9cbiAgICByZWFkRG91YmxlID0gdGhpcy5yZWFkRmxvYXQ2NDtcblxuICAgIHdyaXRlRmxvYXQ2NCh2YWx1ZTogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMuYnVmZmVyLndyaXRlRmxvYXQ2NCh2YWx1ZSk7XG4gICAgfVxuXG4gICAgLyoqIEBkZXByZWNhdGVkIHVzZSB3cml0ZUZsb2F0NjQoKSBpbnN0ZWFkICovXG4gICAgd3JpdGVEb3VibGUgPSB0aGlzLndyaXRlRmxvYXQ2NDtcblxuICAgIHdyaXRlU3RyaW5nKHZhbHVlOiBzdHJpbmcsIGZpeGVkTGVuZ3RoPzogbnVtYmVyKSB7XG4gICAgICAgIHB1dFN0cmluZyh0aGlzLmJ1ZmZlciwgdmFsdWUsIGZpeGVkTGVuZ3RoIHx8IHZhbHVlLmxlbmd0aCk7XG4gICAgfVxuXG4gICAgcmVhZFN0cmluZzgoKSB7XG4gICAgICAgIHJldHVybiBtYWtlU3RyaW5nKHRoaXMuYnVmZmVyLCA4KTtcbiAgICB9XG5cbiAgICB3cml0ZVN0cmluZzgodmFsdWU6IHN0cmluZykge1xuICAgICAgICBwdXRTdHJpbmcodGhpcy5idWZmZXIsIHZhbHVlLCA4KTtcbiAgICB9XG5cbiAgICB3cml0ZVN0cmluZzMwKHZhbHVlOiBzdHJpbmcpIHtcbiAgICAgICAgcHV0U3RyaW5nKHRoaXMuYnVmZmVyLCB2YWx1ZSwgMzApO1xuICAgIH1cblxuICAgIHJlYWRTdHJpbmczMigpIHtcbiAgICAgICAgcmV0dXJuIG1ha2VTdHJpbmcodGhpcy5idWZmZXIsIDMyKTtcbiAgICB9XG5cbiAgICB3cml0ZVN0cmluZzMyKHZhbHVlOiBzdHJpbmcpIHtcbiAgICAgICAgcHV0U3RyaW5nKHRoaXMuYnVmZmVyLCB2YWx1ZSwgMzIpO1xuICAgIH1cblxuICAgIHJlYWRTdHJpbmc2NCgpIHtcbiAgICAgICAgcmV0dXJuIG1ha2VTdHJpbmcodGhpcy5idWZmZXIsIDY0KTtcbiAgICB9XG5cbiAgICB3cml0ZVN0cmluZzY0KHZhbHVlOiBzdHJpbmcpIHtcbiAgICAgICAgcHV0U3RyaW5nKHRoaXMuYnVmZmVyLCB2YWx1ZSwgNjQpO1xuICAgIH1cblxuICAgIHJlYWRTdHJpbmcxMjgoKSB7XG4gICAgICAgIHJldHVybiBtYWtlU3RyaW5nKHRoaXMuYnVmZmVyLCAxMjgpO1xuICAgIH1cblxuICAgIHdyaXRlU3RyaW5nMTI4KHZhbHVlOiBzdHJpbmcpIHtcbiAgICAgICAgcHV0U3RyaW5nKHRoaXMuYnVmZmVyLCB2YWx1ZSwgMTI4KTtcbiAgICB9XG5cbiAgICByZWFkU3RyaW5nMjU2KCkge1xuICAgICAgICByZXR1cm4gbWFrZVN0cmluZyh0aGlzLmJ1ZmZlciwgMjU2KTtcbiAgICB9XG5cbiAgICB3cml0ZVN0cmluZzI1Nih2YWx1ZTogc3RyaW5nIHwgbnVsbCkge1xuICAgICAgICBwdXRTdHJpbmcodGhpcy5idWZmZXIsIHZhbHVlLCAyNTYpO1xuICAgIH1cblxuICAgIHJlYWRTdHJpbmcyNjAoKSB7XG4gICAgICAgIHJldHVybiBtYWtlU3RyaW5nKHRoaXMuYnVmZmVyLCAyNjApO1xuICAgIH1cblxuICAgIHdyaXRlU3RyaW5nMjYwKHZhbHVlOiBzdHJpbmcpIHtcbiAgICAgICAgcHV0U3RyaW5nKHRoaXMuYnVmZmVyLCB2YWx1ZSwgMjYwKTtcbiAgICB9XG5cbiAgICByZWFkU3RyaW5nVigpIHtcbiAgICAgICAgbGV0IGJ5dGVzUmVhZCA9IDA7XG4gICAgICAgIGxldCBzdHJMZW4gPSAwO1xuICAgICAgICBsZXQgZW5kRm91bmQgPSBmYWxzZTtcbiAgICAgICAgd2hpbGUgKHRoaXMuYnVmZmVyLm9mZnNldCA8IHRoaXMuYnVmZmVyLmxpbWl0KSB7XG4gICAgICAgICAgICBjb25zdCBjdXJyZW50Qnl0ZSA9IHRoaXMuYnVmZmVyLnJlYWRCeXRlKCk7XG4gICAgICAgICAgICBieXRlc1JlYWQrKztcbiAgICAgICAgICAgIGlmIChlbmRGb3VuZCAmJiBjdXJyZW50Qnl0ZSAhPT0gMCkge1xuICAgICAgICAgICAgICAgIGJyZWFrOyAvLyBSZWFjaGVkIGJlZ2lubmluZyBvZiBuZXcgdmFsdWVcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoY3VycmVudEJ5dGUgPT09IDApIHtcbiAgICAgICAgICAgICAgICBlbmRGb3VuZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzdHJMZW4rKztcbiAgICAgICAgfVxuICAgICAgICAvLyBSZXNldCBvZmZzZXQgc28gd2UgY2FuIHJlYWQgdGhlIHNhbWUgYnl0ZXMgbGF0ZXJcbiAgICAgICAgdGhpcy5idWZmZXIub2Zmc2V0IC09IGJ5dGVzUmVhZDtcbiAgICAgICAgcmV0dXJuIG1ha2VTdHJpbmcodGhpcy5idWZmZXIsIHN0ckxlbik7XG4gICAgfVxuXG4gICAgcmVhZFN0cmluZyhsZW5ndGg6IG51bWJlcikge1xuICAgICAgICByZXR1cm4gbWFrZVN0cmluZyh0aGlzLmJ1ZmZlciwgbGVuZ3RoKTtcbiAgICB9XG5cbiAgICByZW1haW5pbmcoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJ1ZmZlci5yZW1haW5pbmcoKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIG1ha2VTdHJpbmcoYmY6IEJ5dGVCdWZmZXIsIGV4cGVjdGVkTGVuZ3RoOiBudW1iZXIpIHtcbiAgICBjb25zdCBjb250ZW50ID0gYmYucmVhZENTdHJpbmcoYmYub2Zmc2V0KTtcbiAgICBiZi5za2lwKGV4cGVjdGVkTGVuZ3RoKTtcbiAgICByZXR1cm4gY29udGVudC5zdHJpbmc7XG59XG5cbmZ1bmN0aW9uIHB1dFN0cmluZyhiZjogQnl0ZUJ1ZmZlciwgczogc3RyaW5nIHwgbnVsbCwgZml4ZWQ6IG51bWJlcikge1xuICAgIGNvbnN0IHZhbHVlID0gcyA9PT0gbnVsbCA/ICcnIDogcztcbiAgICBjb25zdCBieXRlcyA9IEJ1ZmZlci5mcm9tKHZhbHVlLCAndXRmLTgnKTtcbiAgICBiZi5hcHBlbmQoYnl0ZXMpO1xuICAgIGlmIChieXRlcy5sZW5ndGggPCBmaXhlZCkge1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZpeGVkIC0gYnl0ZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGJmLndyaXRlQnl0ZSgweDAwKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0IHsgUmF3QnVmZmVyIH07XG4iXX0=